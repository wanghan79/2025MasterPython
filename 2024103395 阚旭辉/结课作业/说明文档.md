
# 图编辑距离预测项目说明文档

## 一、项目目标

本项目旨在基于图神经网络（GNN）和图匹配算法，构建一个自动化预测图编辑距离（Graph Edit Distance, GED）的系统。GED 是衡量两个图结构差异的重要指标，广泛应用于图结构比较、模式识别、化学分子比对等领域。

本系统通过学习图的结构表示，结合节点匹配成本估计，实现对图之间 GED 的高效近似预测。

---

## 二、主要模块与实现思路

### 1. 数据加载与图对构建（`data_loader.py`）

- **功能**：从 JSON 文件中读取图结构数据，构造 DGL 图对象，并自动生成图对。
- **方法**：
  - `load_graphs_from_json()`：读取图结构（包含节点数、边和特征）。
  - `load_graph_pairs()`：两两组合图对，并以节点数差的绝对值作为 GED 近似标签。

### 2. 图神经网络编码器（`gnn_model.py`）

- **功能**：基于 DGL 的 `GraphConv` 层，对输入图进行编码，提取图的结构表示。
- **结构**：
  - 两层 GCN（Graph Convolutional Network）+ ReLU 激活。
  - 使用 `dgl.mean_nodes()` 聚合节点特征，得到图级表示（Graph-level Embedding）。

### 3. GED预测器（`ged_predictor.py`）

- **功能**：接受两个图的嵌入向量，预测其 GED 值。
- **实现**：一个两层全连接 MLP，对两个图表示拼接后回归 GED 值。

### 4. 匹配与对齐模块（`matching_utils.py`）

- **功能**：提供节点间匹配成本计算和匈牙利算法对齐。
- **方法**：
  - `compute_match_score()`：使用 `torch.cdist` 计算匹配成本矩阵。
  - `hungarian_matching()`：基于 SciPy 实现的线性分配求解。

### 5. Sinkhorn归一化模块（`sinkhorn.py`）

- **功能**：实现 Sinkhorn 算法，对节点匹配概率矩阵进行双重归一化。
- **用途**：用于近似最优匹配概率估计（未在当前主流程中直接调用，但为后续改进留下扩展空间）。

### 6. 训练与评估主流程（`trainer.py`）

- **核心类**：`GedTrainer`
- **流程**：
  - 加载图与图对，构建编码器和预测器。
  - 在 `train()` 中迭代训练图对，最小化 MSE 损失。
  - 在 `evaluate()` 中对所有图对进行推理并报告平均误差。
  - 支持 GPU 加速。

### 7. 启动入口（`main.py`）

- **功能**：调用 `GedTrainer` 的 `train()` 和 `evaluate()` 方法，启动整个训练和测试流程。

---

## 三、实现特色

- 支持任意图结构（只要能转换为 JSON 格式），具有良好泛化能力。
- 引入 GNN 表征图结构特征，较传统方法更具表达力。
- 支持后续扩展：可加入 Sinkhorn 优化、路径对比损失、图匹配启发式等高级模块。
