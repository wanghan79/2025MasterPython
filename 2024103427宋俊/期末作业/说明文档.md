## 主要目标
这段室内定位的代码主要目标是：利用混合神经网络（HyNN）对多天线 CSI（信道状态信息）数据进行建模，实现对二维坐标（Position X 和 Y）
的高精度预测。HyNN 模型结合了数值特征与图像特征，通过多分支神经网络结构进行融合建模，最终分别预测出目标的 X 和 Y 坐标。

## 设计思路
第一阶段：环境配置与任务调度

该代码被设计用于在高性能计算环境（如 SLURM 集群）中运行，因此脚本开始部分包含了任务调度配置。它定义了作业名称、运行的 GPU 分区、所需资源（如 CPU 核心数、显存等）以及任务输出/错误文件的保存路径。随后脚本会进入当前提交目录，加载 micromamba 虚拟环境，并设置环境变量以确保库路径正确。

第二阶段：参数读取与数据加载

脚本通过命令行参数接收数据集路径、阵列类型（如 ULA、URA、DIS）以及天线数量。然后使用 Pandas 读取对应的 CSV 文件，该文件包含原始 CSI 数据和定位标签（即目标的 X、Y 位置）。接着对除最后两列之外的所有特征进行归一化处理，统一数值尺度，为后续训练创造良好的输入条件。

第三阶段：伪图像生成（TINTO）

为了充分挖掘 CSI 数据的空间特征，脚本利用 TINTO 算法将 CSI 特征转换成热图形式的伪图像。该过程通过将 CSI 数据结构化为二维像素矩阵，并保存为 RGB 图像（默认为 35×35 分辨率）。这部分图像作为 CNN 输入，是 HyNN 模型融合图像与表格数据的关键。

第四阶段：数据集划分与图像加载

归一化后的表格数据与生成的图像路径进行融合，并随机打乱样本顺序。随后将数据按比例划分为训练集、验证集和测试集，比例分别为 85%、10% 和 5%。图像部分通过 cv2.imread 和 cv2.resize 读入成 NumPy 数组，作为模型输入的图像分支。

第五阶段：模型构建（X 与 Y 分别训练）

整个模型为双通道结构，包括一个表格数据处理分支（MLP）和一个图像处理分支（CNN），最后通过 Transformer 进行跨模态特征融合。

表格分支使用两个并行的深层全连接网络（每个层数逐步减少），其输出拼接形成最终的结构化表示。

图像分支通过两个不同卷积核尺寸（3×3 与 5×5）构建的 CNN 分支并行提取图像特征，模拟 Inception 架构思想。

两个分支的输出融合后送入 Transformer 模块，使用多头注意力机制建模其内部关联，增强跨模态表示能力。

Transformer 输出经过 flatten 和数个全连接层，最终输出一个标量作为预测结果。

该过程对 Position X 和 Position Y 分别建模与训练，结构类似但输出目标不同，分别生成两个模型（modelX.h5 和 modelY.h5）。

第六阶段：训练过程与回调机制

训练过程中使用均方误差（MSE）作为损失函数，同时评估 MAE、RMSE 和 R² 等指标。Adam 优化器用于权重更新，训练过程中使用 EarlyStopping 机制，当验证集误差连续 20 轮不再下降时停止训练，以防过拟合并保留最佳模型参数。

第七阶段：预测与误差评估

模型训练完成后，在验证集和测试集上分别预测 X 和 Y 坐标，并通过欧氏距离函数 true_dist 计算总体定位误差。同时对每一坐标轴单独计算 MAE、MSE、RMSE 和 R² 评价指标，结果以文本形式输出并保存至文件中。

第八阶段：结果保存与组织

模型文件、预测结果（CSV 格式）以及误差评估结果都会保存至预设的目录结构中。该结构根据天线数量与阵列类型命名，确保不同实验之间的结果不会混淆，便于后续复现实验与对比分析。
