
# ESSRec æ¨èç³»ç»Ÿæ¨¡å‹è¯´æ˜æ–‡æ¡£

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªç”¨äºå¸¦æœ‰æ­£è´Ÿç¤¾äº¤ç½‘ç»œä¿¡æ¯çš„æ¨èç³»ç»Ÿæ¨¡å‹ **ESSRec (Embedding + Signed Social network Recommendation with contrastive learning)**ï¼Œå¹¶åŸºäº Epinions æ•°æ®é›†è¿›è¡Œè®­ç»ƒå’Œè¯„ä¼°ã€‚

---

##  1. æ•°æ®å¤„ç†æ¨¡å—ï¼ˆ`InteractionDataset` & `EpinionsDataset`ï¼‰

### `InteractionDataset`

ç”¨äºå°† `(user, item, rating)` æ•°æ®è½¬æ¢ä¸ºæ¨¡å‹è¾“å…¥æ ¼å¼ï¼š
- è‡ªåŠ¨å°† `user_id`, `item_id` è½¬æ¢ä¸º `torch.long` ç±»å‹ã€‚
- å°† `rating` è½¬ä¸º `torch.float32`ã€‚
- æä¾› `collate_fn` æ”¯æŒæ‰¹é‡å¤„ç†ã€‚

### `EpinionsDataset`

è´Ÿè´£ä»æ–‡ä»¶ä¸­åŠ è½½æ•°æ®å¹¶é¢„å¤„ç†ï¼š
- `epinions.inter`: ç”¨æˆ·-ç‰©å“è¯„åˆ†ã€‚
- `epinions.net`: ç”¨æˆ·-ç”¨æˆ·ç¬¦å·ç¤¾äº¤ç½‘ç»œï¼ˆÂ±1ï¼‰ã€‚

ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š
- `_load_inter` / `_load_net`ï¼šåŠ è½½æ–‡ä»¶ã€‚
- `_build_interaction_matrix`ï¼šæ„å»ºè¯„åˆ†ç¨€ç–çŸ©é˜µã€‚
- `_build_net_matrix`ï¼šæ„å»ºç¬¦å·ç¤¾äº¤çŸ©é˜µã€‚
- `_train_test_split`ï¼šåˆ’åˆ†è®­ç»ƒé›†ä¸æµ‹è¯•é›†ã€‚

---

##  2. ESSRec æ¨¡å‹æ¶æ„è¯¦è§£

### æ¨¡å‹åˆå§‹åŒ–
- è·å–ç”¨æˆ·æ•°ã€ç‰©å“æ•°ã€‚
- æ„å»º interaction graph å’Œ social graph çš„å·ç§¯çŸ©é˜µã€‚
- åˆå§‹åŒ–å¤šä¸ªåµŒå…¥å±‚ä¸ `Linear` å±‚ã€‚
- å‚æ•°åŒ…æ‹¬ï¼š
  - `embedding_size`
  - `gnn_layer_size`, `gnn_layer_size_k`
  - `sim_threshold`ã€`contrast_margin`

### `forward` å‰å‘ä¼ æ’­é€»è¾‘
1. åœ¨ç”¨æˆ·-ç‰©å“å›¾ä¸Šè¿›è¡Œ GCN èšåˆï¼Œå¾—åˆ°åˆå§‹åµŒå…¥ã€‚
2. å¯¹ item è¿›è¡Œè¿›ä¸€æ­¥èšåˆã€‚
3. å°† user å’Œ item èåˆï¼Œå¹¶è¿›è¡Œ signed GCN å¤šé˜¶èšåˆï¼š
   - æ¯ä¸€å±‚é€šè¿‡ `graph_convolution` è¿›è¡Œä¼ æ’­ã€‚
   - åˆ†ç¦»å¤„ç†ä¿¡ä»»è¾¹ (P)ã€ä¸ä¿¡ä»»è¾¹ (N)ã€ä¸­æ€§è¾¹ (O)ã€‚
   - æœ€ç»ˆå°† P/N/O çš„ç»“æœèåˆä¸ºç”¨æˆ·æœ€ç»ˆè¡¨ç¤ºã€‚

### `graph_convolution`
- ä½¿ç”¨ 3 ç§å·ç§¯çŸ©é˜µ (P/N/O) åˆ†åˆ«ä¼ æ’­ã€‚
- å¤šå±‚èšåˆå®ç°ä¿¡æ¯è·¨ hop çš„ä¼ é€’ã€‚

### ç›¸ä¼¼åº¦åˆ’åˆ†ï¼š`get_signed_split_matrices`
- åŸºäº cosine ç›¸ä¼¼åº¦ + ç¤¾äº¤è¾¹ sign å¯¹è¾¹è¿›è¡Œåˆ†ç±»ï¼š
  - `P`: ç›¸ä¼¼ + ä¿¡ä»»
  - `N`: ä¸ç›¸ä¼¼ + ä¸ä¿¡ä»»
  - `O`: å…¶ä»–

---

## ğŸ”€ 3. å¯¹æ¯”å­¦ä¹ æ¨¡å—

### `contrastive_loss_intra_view`
- é’ˆå¯¹åŒä¸€è§†å›¾ï¼ˆç”¨æˆ·ä¹‹é—´ï¼‰å¼•å…¥å¯¹æ¯”å­¦ä¹ ï¼š
  - æ­£è¾¹ï¼šæœ€å°åŒ– $1 - \cos(emb_1, emb_2)$
  - è´Ÿè¾¹ï¼šæœ€å¤§åŒ– $-\cos(emb_1, emb_2) + margin$
- æ”¯æŒé‡‡æ ·ä»¥æé«˜è®­ç»ƒæ•ˆç‡ã€‚

---

## ğŸ‹ï¸â€â™€ï¸ 4. è®­ç»ƒä¸è¯„ä¼°æ¨¡å—

### `train_model`
- æ”¯æŒå¤šè½® epoch è®­ç»ƒã€‚
- æŸå¤±å‡½æ•°ä¸ºï¼š
  ```python
  loss = (1 - Î±) * MSE + Î± * ContrastiveLoss
  ```
- æ¯è½®åè¾“å‡ºï¼š
  - å¹³å‡æŸå¤±
  - RMSEï¼ˆå‡æ–¹æ ¹è¯¯å·®ï¼‰
  - MAEï¼ˆå¹³å‡ç»å¯¹è¯¯å·®ï¼‰

### `evaluate_model`
- åœ¨ test_loader ä¸Šè¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚

---

## ğŸš€ 5. ä¸»ç¨‹åºæ‰§è¡Œæµç¨‹

### å…³é”®æ­¥éª¤
```python
dataset = EpinionsDataset(inter_path, net_path)

args = Args(
    embedding_size=16,
    gnn_layer_size=2,
    gnn_layer_size_k=2,
    sim_threshold=0.2,
    lr=1e-3,
    contrast_margin=1.0,
    device=torch.device("cuda:1" if torch.cuda.is_available() else "cpu")
)

model = train_model(dataset, args, dataset.train_data, dataset.test_data,
                    epochs=50, batch_size=40960, alpha=0.5)
```

---

##  æ€»ç»“ä¸äº®ç‚¹

| æ¨¡å— | ç‰¹ç‚¹ |
|------|------|
| æ•°æ®å±‚ | æ”¯æŒ ID é‡æ˜ å°„ã€Epinions è‡ªå®šä¹‰è§£æ |
| æ¨¡å‹å±‚ | ESSRec æ¨¡å‹ç»“åˆäº† signed GCN + ç”¨æˆ·å¯¹æ¯”å­¦ä¹  |
| ä¿¡æ¯ä¼ æ’­ | å¤šé˜¶ signed GCNï¼Œæ”¯æŒä¸‰ç±»è¿æ¥è¾¹ï¼ˆP/N/Oï¼‰ |
| æŸå¤±å‡½æ•° | é¢„æµ‹æŸå¤± + å¯¹æ¯”æŸå¤±ï¼ˆæƒé‡å¯è°ƒï¼‰ |
| åµŒå…¥èåˆ | å¤šå±‚çº¿æ€§å˜æ¢ï¼Œæå‡è¡¨è¾¾èƒ½åŠ› |

---
